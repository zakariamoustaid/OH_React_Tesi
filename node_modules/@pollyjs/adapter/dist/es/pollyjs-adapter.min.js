import{assert as t,PollyError as e,MODES as r,ACTIONS as n,EXPIRY_STRATEGIES as o,Serializers as i}from"@pollyjs/utils";function s(t,e){return t(e={exports:{}},e.exports),e.exports}var u=s(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),a=(u.version,u.JSON||(u.JSON={stringify:JSON.stringify})),c=function(t){return a.stringify.apply(a,arguments)},f={}.toString,l=function(t){return f.call(t).slice(8,-1)},p=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==l(t)?t.split(""):Object(t)},h=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},y=function(t){return p(h(t))},d={f:{}.propertyIsEnumerable},g=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},b=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t,e){if(!b(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!b(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!b(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!b(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},v={}.hasOwnProperty,w=function(t,e){return v.call(t,e)},O=function(t){try{return!!t()}catch(t){return!0}},S=!O(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),R=s(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),P=R.document,j=b(P)&&b(P.createElement),E=function(t){return j?P.createElement(t):{}},_=!S&&!O(function(){return 7!=Object.defineProperty(E("div"),"a",{get:function(){return 7}}).a}),F=Object.getOwnPropertyDescriptor,q={f:S?F:function(t,e){if(t=y(t),e=m(e,!0),_)try{return F(t,e)}catch(t){}if(w(t,e))return g(!d.f.call(t,e),t[e])}},N=function(t,e,r){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},T=function(t){if(!b(t))throw TypeError(t+" is not an object!");return t},k=Object.defineProperty,x={f:S?Object.defineProperty:function(t,e,r){if(T(t),e=m(e,!0),T(r),_)try{return k(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},I=S?function(t,e,r){return x.f(t,e,g(1,r))}:function(t,e,r){return t[e]=r,t},D=function(t,e,r){var n,o,i,s=t&D.F,a=t&D.G,c=t&D.S,f=t&D.P,l=t&D.B,p=t&D.W,h=a?u:u[e]||(u[e]={}),y=h.prototype,d=a?R:c?R[e]:(R[e]||{}).prototype;for(n in a&&(r=e),r)(o=!s&&d&&void 0!==d[n])&&w(h,n)||(i=o?d[n]:r[n],h[n]=a&&"function"!=typeof d[n]?r[n]:l&&o?N(i,R):p&&d[n]==i?function(t){var e=function(e,r,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,n)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):f&&"function"==typeof i?N(Function.call,i):i,f&&((h.virtual||(h.virtual={}))[n]=i,t&D.R&&y&&!y[n]&&I(y,n,i)))};D.F=1,D.G=2,D.S=4,D.P=8,D.B=16,D.W=32,D.U=64,D.R=128;var C=D,M=function(t,e){var r=(u.Object||{})[t]||Object[t],n={};n[t]=e(r),C(C.S+C.F*O(function(){r(1)}),"Object",n)},A=q.f;M("getOwnPropertyDescriptor",function(){return function(t,e){return A(y(t),e)}});var J,W=u.Object,$=function(t,e){return W.getOwnPropertyDescriptor(t,e)},z=I,G=0,B=Math.random(),K=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++G+B).toString(36))},Y=s(function(t){var e=K("meta"),r=x.f,n=0,o=Object.isExtensible||function(){return!0},i=!O(function(){return o(Object.preventExtensions({}))}),s=function(t){r(t,e,{value:{i:"O"+ ++n,w:{}}})},u=t.exports={KEY:e,NEED:!1,fastKey:function(t,r){if(!b(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!w(t,e)){if(!o(t))return"F";if(!r)return"E";s(t)}return t[e].i},getWeak:function(t,r){if(!w(t,e)){if(!o(t))return!0;if(!r)return!1;s(t)}return t[e].w},onFreeze:function(t){return i&&u.NEED&&o(t)&&!w(t,e)&&s(t),t}}}),H=(Y.KEY,Y.NEED,Y.fastKey,Y.getWeak,Y.onFreeze,s(function(t){var e=R["__core-js_shared__"]||(R["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:u.version,mode:"pure",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),L=s(function(t){var e=H("wks"),r=R.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:K)("Symbol."+t))}).store=e}),U=x.f,Q=L("toStringTag"),Z=function(t,e,r){t&&!w(t=r?t:t.prototype,Q)&&U(t,Q,{configurable:!0,value:e})},V={f:L},X=x.f,tt=function(t){var e=u.Symbol||(u.Symbol={});"_"==t.charAt(0)||t in e||X(e,t,{value:V.f(t)})},et=Math.ceil,rt=Math.floor,nt=function(t){return isNaN(t=+t)?0:(t>0?rt:et)(t)},ot=Math.min,it=Math.max,st=Math.min,ut=H("keys"),at=function(t){return ut[t]||(ut[t]=K(t))},ct=(J=!1,function(t,e,r){var n,o,i=y(t),s=(n=i.length)>0?ot(nt(n),9007199254740991):0,u=function(t,e){return(t=nt(t))<0?it(t+e,0):st(t,e)}(r,s);if(J&&e!=e){for(;s>u;)if((o=i[u++])!=o)return!0}else for(;s>u;u++)if((J||u in i)&&i[u]===e)return J||u||0;return!J&&-1}),ft=at("IE_PROTO"),lt=function(t,e){var r,n=y(t),o=0,i=[];for(r in n)r!=ft&&w(n,r)&&i.push(r);for(;e.length>o;)w(n,r=e[o++])&&(~ct(i,r)||i.push(r));return i},pt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ht=Object.keys||function(t){return lt(t,pt)},yt={f:Object.getOwnPropertySymbols},dt=Array.isArray||function(t){return"Array"==l(t)},gt=function(t){return Object(h(t))},bt=S?Object.defineProperties:function(t,e){T(t);for(var r,n=ht(e),o=n.length,i=0;o>i;)x.f(t,r=n[i++],e[r]);return t},mt=R.document,vt=mt&&mt.documentElement,wt=at("IE_PROTO"),Ot=function(){},St=function(){var t,e=E("iframe"),r=pt.length;for(e.style.display="none",vt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),St=t.F;r--;)delete St.prototype[pt[r]];return St()},Rt=Object.create||function(t,e){var r;return null!==t?(Ot.prototype=T(t),r=new Ot,Ot.prototype=null,r[wt]=t):r=St(),void 0===e?r:bt(r,e)},Pt=pt.concat("length","prototype"),jt={f:Object.getOwnPropertyNames||function(t){return lt(t,Pt)}},Et=jt.f,_t={}.toString,Ft="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],qt={f:function(t){return Ft&&"[object Window]"==_t.call(t)?function(t){try{return Et(t)}catch(t){return Ft.slice()}}(t):Et(y(t))}},Nt=Y.KEY,Tt=q.f,kt=x.f,xt=qt.f,It=R.Symbol,Dt=R.JSON,Ct=Dt&&Dt.stringify,Mt=L("_hidden"),At=L("toPrimitive"),Jt={}.propertyIsEnumerable,Wt=H("symbol-registry"),$t=H("symbols"),zt=H("op-symbols"),Gt=Object.prototype,Bt="function"==typeof It&&!!yt.f,Kt=R.QObject,Yt=!Kt||!Kt.prototype||!Kt.prototype.findChild,Ht=S&&O(function(){return 7!=Rt(kt({},"a",{get:function(){return kt(this,"a",{value:7}).a}})).a})?function(t,e,r){var n=Tt(Gt,e);n&&delete Gt[e],kt(t,e,r),n&&t!==Gt&&kt(Gt,e,n)}:kt,Lt=function(t){var e=$t[t]=Rt(It.prototype);return e._k=t,e},Ut=Bt&&"symbol"==typeof It.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof It},Qt=function(t,e,r){return t===Gt&&Qt(zt,e,r),T(t),e=m(e,!0),T(r),w($t,e)?(r.enumerable?(w(t,Mt)&&t[Mt][e]&&(t[Mt][e]=!1),r=Rt(r,{enumerable:g(0,!1)})):(w(t,Mt)||kt(t,Mt,g(1,{})),t[Mt][e]=!0),Ht(t,e,r)):kt(t,e,r)},Zt=function(t,e){T(t);for(var r,n=function(t){var e=ht(t),r=yt.f;if(r)for(var n,o=r(t),i=d.f,s=0;o.length>s;)i.call(t,n=o[s++])&&e.push(n);return e}(e=y(e)),o=0,i=n.length;i>o;)Qt(t,r=n[o++],e[r]);return t},Vt=function(t){var e=Jt.call(this,t=m(t,!0));return!(this===Gt&&w($t,t)&&!w(zt,t))&&(!(e||!w(this,t)||!w($t,t)||w(this,Mt)&&this[Mt][t])||e)},Xt=function(t,e){if(t=y(t),e=m(e,!0),t!==Gt||!w($t,e)||w(zt,e)){var r=Tt(t,e);return!r||!w($t,e)||w(t,Mt)&&t[Mt][e]||(r.enumerable=!0),r}},te=function(t){for(var e,r=xt(y(t)),n=[],o=0;r.length>o;)w($t,e=r[o++])||e==Mt||e==Nt||n.push(e);return n},ee=function(t){for(var e,r=t===Gt,n=xt(r?zt:y(t)),o=[],i=0;n.length>i;)!w($t,e=n[i++])||r&&!w(Gt,e)||o.push($t[e]);return o};Bt||(z((It=function(){if(this instanceof It)throw TypeError("Symbol is not a constructor!");var t=K(arguments.length>0?arguments[0]:void 0),e=function(r){this===Gt&&e.call(zt,r),w(this,Mt)&&w(this[Mt],t)&&(this[Mt][t]=!1),Ht(this,t,g(1,r))};return S&&Yt&&Ht(Gt,t,{configurable:!0,set:e}),Lt(t)}).prototype,"toString",function(){return this._k}),q.f=Xt,x.f=Qt,jt.f=qt.f=te,d.f=Vt,yt.f=ee,V.f=function(t){return Lt(L(t))}),C(C.G+C.W+C.F*!Bt,{Symbol:It});for(var re="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;re.length>ne;)L(re[ne++]);for(var oe=ht(L.store),ie=0;oe.length>ie;)tt(oe[ie++]);C(C.S+C.F*!Bt,"Symbol",{for:function(t){return w(Wt,t+="")?Wt[t]:Wt[t]=It(t)},keyFor:function(t){if(!Ut(t))throw TypeError(t+" is not a symbol!");for(var e in Wt)if(Wt[e]===t)return e},useSetter:function(){Yt=!0},useSimple:function(){Yt=!1}}),C(C.S+C.F*!Bt,"Object",{create:function(t,e){return void 0===e?Rt(t):Zt(Rt(t),e)},defineProperty:Qt,defineProperties:Zt,getOwnPropertyDescriptor:Xt,getOwnPropertyNames:te,getOwnPropertySymbols:ee});var se=O(function(){yt.f(1)});C(C.S+C.F*se,"Object",{getOwnPropertySymbols:function(t){return yt.f(gt(t))}}),Dt&&C(C.S+C.F*(!Bt||O(function(){var t=It();return"[null]"!=Ct([t])||"{}"!=Ct({a:t})||"{}"!=Ct(Object(t))})),"JSON",{stringify:function(t){for(var e,r,n=[t],o=1;arguments.length>o;)n.push(arguments[o++]);if(r=e=n[1],(b(e)||void 0!==t)&&!Ut(t))return dt(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Ut(e))return e}),n[1]=e,Ct.apply(Dt,n)}}),It.prototype[At]||I(It.prototype,At,It.prototype.valueOf),Z(It,"Symbol"),Z(Math,"Math",!0),Z(R.JSON,"JSON",!0);var ue=u.Object.getOwnPropertySymbols;M("keys",function(){return function(t){return ht(gt(t))}});var ae=u.Object.keys;C(C.S+C.F*!S,"Object",{defineProperty:x.f});var ce=u.Object,fe=function(t,e,r){return ce.defineProperty(t,e,r)};var le=function(t,e,r){return e in t?fe(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var pe,he=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=ae(r);"function"==typeof ue&&(n=n.concat(ue(r).filter(function(t){return $(r,t).enumerable}))),n.forEach(function(e){le(t,e,r[e])})}return t},ye=Object.freeze({});tt("asyncIterator"),tt("observable"),(pe=ye)&&pe.default;var de=u.Symbol,ge="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029\ufeff",be="["+ge+"]",me=RegExp("^"+be+be+"*"),ve=RegExp(be+be+"*$"),we=function(t,e,r){var n={},o=O(function(){return!!ge[t]()||"âÂ"!="âÂ"[t]()}),i=n[t]=o?e(Oe):ge[t];r&&(n[r]=i),C(C.P+C.F*o,"String",n)},Oe=we.trim=function(t,e){return t=String(h(t)),1&e&&(t=t.replace(me,"")),2&e&&(t=t.replace(ve,"")),t},Se=we,Re=R.parseFloat,Pe=Se.trim,je=1/Re(ge+"-0")!=-1/0?function(t){var e=Pe(String(t),3),r=Re(e);return 0===r&&"-"==e.charAt(0)?-0:r}:Re;C(C.G+C.F*(parseFloat!=je),{parseFloat:je});var Ee=u.parseFloat;const _e=/([0-9.]+)([a-zA-Z]+)/g,Fe={ms:1,millisecond:1,milliseconds:1,s:1e3,sec:1e3,secs:1e3,second:1e3,seconds:1e3,m:6e4,min:6e4,mins:6e4,minute:6e4,minutes:6e4,h:36e5,hr:36e5,hrs:36e5,hour:36e5,hours:36e5,d:864e5,day:864e5,days:864e5,w:6048e5,wk:6048e5,wks:6048e5,week:6048e5,weeks:6048e5,y:31536e6,yr:31536e6,yrs:31536e6,year:31536e6,years:31536e6};function qe(t,e){return!(!t||!e)&&new Date>new Date(new Date(t).getTime()+("string"!=typeof(r=e)?NaN:r.replace(/ /g,"").match(_e).map(t=>t.split(_e).filter(t=>t)).reduce((t,[e,r])=>t+Ee(e)*Fe[r],0)));var r}function Ne(t,...e){const r=he({},t.config);return["adapter","adapterOptions","persister","persisterOptions"].forEach(t=>delete r[t]),c({url:t.url,method:t.method,headers:t.headers,body:t.body,recordingName:t.recordingName,id:t.id,order:t.order,identifiers:t.identifiers,config:r},...e)}const{isArray:Te}=Array;function ke(t){return(t||[]).reduce((t,{name:e,value:r,_fromType:n})=>{const o=t[e];return o?(Te(o)||(t[e]=[o]),t[e].push(r)):t[e]="array"===n?[r]:r,t},{})}const xe=de();export default class{constructor(t){this.polly=t,this.isConnected=!1}static get type(){return"adapter"}static get id(){t("Must override the static `id` getter.")}get defaultOptions(){return{}}get options(){return he({},this.defaultOptions||{},(this.polly.config.adapterOptions||{})[this.constructor.id]||{})}get persister(){return this.polly.persister}connect(){this.isConnected||(this.onConnect(),this.isConnected=!0)}disconnect(){this.isConnected&&(this.onDisconnect(),this.isConnected=!1)}timeout(t,{time:e}){const{timing:r}=t.config;if("function"==typeof r)return r(e)}async handleRequest(t){const r=this.polly.registerRequest(t);try{if(r.on("identify",(...t)=>this.onIdentifyRequest(...t)),await this.onRequest(r),await r.init(),await this[xe](r),r.aborted)throw new e("Request aborted.");await this.onRequestFinished(r)}catch(t){await this.onRequestFailed(r,t)}return r}async[xe](t){const{mode:e}=this.polly,{_interceptor:n}=t;if(!(t.aborted||t.shouldIntercept&&(await this.intercept(t,n),n.shouldIntercept)))return e===r.PASSTHROUGH||t.shouldPassthrough||n.shouldPassthrough?this.passthrough(t):(this.assert("A persister must be configured in order to record and replay requests.",!!this.persister),e===r.RECORD?this.record(t):e===r.REPLAY?this.replay(t):void this.assert("Unhandled request: \n"+Ne(t,null,2)))}async passthrough(t){return t.action=n.PASSTHROUGH,this.onPassthrough(t)}async intercept(t,e){if(t.action=n.INTERCEPT,await t._intercept(e),e.shouldIntercept)return this.onIntercept(t,t.response)}async record(t){return t.action=n.RECORD,"navigator"in global&&!navigator.onLine&&console.warn("[Polly] Recording may fail because the browser is offline.\n"+`${Ne(t)}`),this.onRecord(t)}async replay(t){const{config:e}=t,r=await this.persister.findEntry(t);if(r){const i=JSON.parse(c(r));if(await t._emit("beforeReplay",i),qe(i.startedDateTime,e.expiresIn)){const r="Recording for the following request has expired.\n"+`${Ne(t,null,2)}`;switch(e.expiryStrategy){case o.RECORD:return this.record(t);case o.ERROR:this.assert(r);break;case o.WARN:console.warn(`[Polly] ${r}`);break;default:this.assert(`Invalid config option passed for "expiryStrategy": "${e.expiryStrategy}"`)}}return await this.timeout(t,i),t.action=n.REPLAY,this.onReplay(t,function(t){const{status:e,statusText:r,headers:n,content:o}=t;return{statusText:r,statusCode:e,headers:ke(n),body:o&&o.text,isBinary:Boolean(o&&o._isBinary)}}(i.response),i)}if(e.recordIfMissing)return this.record(t);this.assert("Recording for the following request is not found and `recordIfMissing` is `false`.\n"+Ne(t,null,2))}assert(e,...r){t(`[${this.constructor.type}:${this.constructor.id}] ${e}`,...r)}onConnect(){this.assert("Must implement the `onConnect` hook.")}onDisconnect(){this.assert("Must implement the `onDisconnect` hook.")}async passthroughRequest(){this.assert("Must implement the `passthroughRequest` hook.")}async respondToRequest(){}async onRecord(t){await this.onPassthrough(t),t.aborted||await this.persister.recordRequest(t)}async onReplay(t,e){await t.respond(e)}async onIntercept(t,e){await t.respond(e)}async onPassthrough(t){const e=await this.passthroughRequest(t);await t.respond(e)}async onIdentifyRequest(t){const{identifiers:e}=t;for(const t of["blob","formData","buffer"])e.body=await i[t](e.body)}onRequest(){}async onRequestFinished(t){await this.respondToRequest(t),t.promise.resolve()}async onRequestFailed(t,r){const{aborted:n}=t;r=r||new e("Request failed due to an unknown error.");try{n?await t._emit("abort"):await t._emit("error",r),await this.respondToRequest(t,r)}catch(t){throw t}finally{t.promise.reject(r)}}}
//# sourceMappingURL=pollyjs-adapter.min.js.map
